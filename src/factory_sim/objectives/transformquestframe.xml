<?xml version='1.0' encoding='UTF-8'?>
<root BTCPP_format="4" main_tree_to_execute="TransformQuestFrame">
  <BehaviorTree ID="TransformQuestFrame" _description="Listens to grasp topic from controller. When controller grasp is toggled, we save the controller odom position and use that to republish those messages to the controller in the end effector frame " _favorite="false">
    <Control ID="Sequence" name="TopLevelSequence">
      <Control ID="Parallel" failure_count="1" success_count="1">
        <Action ID="GetOdom" odometry_pose="{controller_clutched_pose}" odometry_topic_name="/right_controller_odom" subscribed_odometry="{subscribed_odometry}"/>
        <Action ID="GetEmpty" empty_topic_name="/right_grip_button_event"/>
      </Control>
      <Action ID="GetLatestTransform" source_frame_id="world" target_frame_id="grasp_link" transform="{ee_transform}"/>
      <Action ID="ConvertTransformStampedToPoseStamped" transform_stamped="{ee_transform}" pose_stamped="{ee_pose_world}"/>
      <Action ID="UnpackPoseStampedMessage" header="{controller_header}" pose="{controller_pose_raw}" pose_stamped="{controller_clutched_pose}"/>
      <Action ID="CreateTimeMessage" time="{save_time}" nanosec="0" sec="0"/>
      <Action ID="CreateHeaderMessage" frame_id="world" header="{world_header}" stamp="{save_time}"/>
      <Action ID="CreatePoseStampedMessage" header="{world_header}" pose="{controller_pose_raw}" pose_stamped="{transformed_controller_pose}"/>
      <Action ID="CalculatePoseOffset" destination_pose="{ee_pose_world}" source_pose="{transformed_controller_pose}" source_to_destination_pose="{quest_to_ee_pose}"/>
      <Action ID="UnpackPoseStampedMessage" header="{header}" pose_stamped="{quest_to_ee_pose}" pose="{extracted_pose}"/>
      <Action ID="CreatePoseStampedMessage" pose="{extracted_pose}" header="{world_header}" pose_stamped="{new_ee_pose}"/>
      <Action ID="ConvertPoseStampedToTransformStamped" child_frame_id="world" pose_stamped="{new_ee_pose}" transform_stamped="{transform_stamped}"/>
      <Action ID="ConvertTransformStampedToOdom" odometry="{transformed_odometry}" transform_stamped="{transform_stamped}"/>
    </Control>
  </BehaviorTree>
  <TreeNodesModel>
    <SubTree ID="TransformQuestFrame">
      <inout_port name="transform_stamped" default="{transform_stamped}"/>
      <inout_port name="transformed_odometry" default="{transformed_odometry}" type="nav_msgs::msg::Odometry_&lt;std::allocator&lt;void&gt; &gt;"/>
    </SubTree>
  </TreeNodesModel>
</root>
